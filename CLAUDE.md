# CLAUDE.md - EPUB画像抽出ツール プロジェクト仕様書

このドキュメントは、EPUB画像抽出ツールの開発におけるClaude Codeへの指示と仕様を定義します。

## 🚨 重要な開発ルール

### 1. ビルド検証の必須化
**すべての機能改修・バグ修正後は、必ずビルドが成功することを確認してから作業完了とすること**

#### ビルド検証手順
1. `npm run build` でTypeScriptコンパイルとViteビルドの成功を確認
2. 必要に応じて `npm run dist:mac` または `npm run dist:win` でプロダクションビルドの成功を確認
3. ビルドエラーが発生した場合は、必ず修正してから作業を完了とする

### 2. タスク管理とコミットルール
**タスクリストを作成した場合、1つのタスク完了ごとに必ずgit commitを行うこと**

#### コミット手順
1. タスクが完了したら、関連するすべての変更をステージング
2. タスクの内容を明確に示すコミットメッセージを作成
3. ビルドが成功することを確認してからコミット
4. 次のタスクに着手する前に、現在の状態が安定していることを確認

### 3. テスト作成ルール
- **mockのみのテストは禁止** - 実機能を検証する意味のあるテストを実装すること
- 統合テストでは実際のEPUBファイルを使用し、完全な処理フローを検証すること
- ファイル出力まで確認すること

## 📋 プロジェクト概要

### プロジェクトの目的
EPUBファイルから章別に画像を抽出し、整理されたフォルダ構造で保存するクロスプラットフォーム（Windows/macOS）デスクトップアプリケーションを開発する。

### 主要機能
- **ドラッグ&ドロップGUIインターフェース** - 直感的なファイル入力
- **並列実行での複数ファイル処理** - 高速処理の実現
- **目次を使用した章ベースの画像整理** - 構造化された出力
- **リアルタイム進捗トラッキング** - ユーザーフィードバック
- **包括的エラーハンドリングと報告** - 安定性の確保
- **クロスプラットフォーム実行ファイル配布** - 幅広い利用者への対応

## 🛠 技術仕様

### 技術スタック
- **フレームワーク**: Electron 28
- **プログラミング言語**: TypeScript 5
- **UIライブラリ**: React 18
- **ビルドツール**: Vite 5
- **EPUBパーサー**: xml2jsを使用したカスタム実装
- **国際化**: i18next（初期状態では日本語のみ対応）

### サポート形式
- **EPUB 3.0形式**を完全サポート
- **ZIP圧縮されたEPUBファイル**の自動展開

## 📥 入力処理仕様

### 対応ファイル形式
- EPUBファイル（.epub）
- EPUBを含むZIPファイル（.zip）

### 処理方式
- 複数ファイルを並列実行で同時処理
- ユーザーフィードバック付きファイル形式検証

## 📤 出力仕様

### ディレクトリ構造
```
EPUB_Images/
└── [書籍タイトル]/
    ├── 001_表紙/
    │   ├── 001.jpg
    │   └── 002.jpg
    ├── 002_第1章/
    │   ├── 001.png
    │   ├── 002.png
    │   └── 003.jpg
    └── 003_第2章/
        └── 001.jpg
```

### 命名規則
- **章フォルダ**: `{順序:3桁}_{chapter_title}/`
  - 例: `001_表紙/`, `002_第1章/`
- **画像ファイル**: 連続番号 `001.jpg`, `002.png` など
  - 元の画像ファイル名を引き継ぐのではなく、全てのページに対応して連番とすること
  - オプション: 元のファイル名を含める、見開き情報を含める

### 画像処理
- **形式保持**: 元の画像形式を維持（JPEG、PNG、WebPなど）
- **複数ページ章対応**: 1つの章に複数ページがある場合、すべての画像を同一章フォルダに集約

## 📚 EPUB解析仕様

### 目次処理
- **目次あり**: ナビゲーションドキュメントから章情報を抽出
- **目次なし**: 全画像を `001_未分類/` フォルダに配置
- **ユーザー通知**: 目次情報がない場合のユーザー通知

### 正しい解析フロー
1. `META-INF/container.xml` からOPFファイルのパスを取得
2. OPFファイルに含まれる`itemref`から各ページを認識する
3. ページの示すファイルを解析し、参照している画像パスを取得する

### 注意事項
- @gxl/epub-parser を採用した場合、`navigation` プロパティを提供しない可能性があるので、その場合は回避策を適用すること

## ⚠️ エラーハンドリング

### エラーハンドリング戦略
- **EPUBレベルエラー**: 他のEPUBの処理を継続、最後にエラー概要を表示
- **内部ファイルエラー**: そのEPUBの処理を停止、詳細なエラー情報をログに記録
- **ユーザー通知**: エラー詳細と処理中断を明確に表示

## 🖥 GUI仕様

### ウィンドウ構成
- **メインウィンドウ**: ドラッグ&ドロップエリア + 進捗表示
- **設定ウィンドウ**: 設定用の別モーダルウィンドウ

### 機能要件
- **進捗トラッキング**: ファイル別のリアルタイム進捗表示
- **出力ディレクトリ**: 設定経由で設定可能（デフォルト: デスクトップ）
- **言語設定**: UIのテキスト、メッセージは多言語対応（i18n）

## 🧪 テスト要件

### 単体テスト
- 各モジュールの個別機能を検証
- モックは最小限に留め、実際の動作を確認

### 統合テスト
- 実際のEPUBファイルでテスト
- 完全な処理フローを検証
- ファイル出力まで確認

## 📝 開発時の注意事項

1. **常にビルドの成功を確認**してから作業を完了とする
2. **1機能1コミット**を心がける
3. **実際の動作を検証するテスト**を作成する
4. **エラーハンドリングを適切に**実装する
5. **ユーザーフィードバックを重視**したUI設計を行う

## 🔄 更新履歴

- 2024-01-XX: 初版作成
- 2024-01-XX: ビルド検証ルールを追加
- 2024-01-XX: v0.1.0リリースに向けた仕様整理