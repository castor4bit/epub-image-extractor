# CLAUDE.md - EPUB画像抽出ツール プロジェクト仕様書

このドキュメントは、EPUB画像抽出ツールの開発におけるClaude Codeへの指示と仕様を定義します。

## 🚨 重要な開発ルール

### 1. テスト駆動開発（TDD）の実践
**すべての新機能・バグ修正はテストファーストで開発すること**
1. 失敗するテストを先に作成
2. テストが通る最小限の実装を行う
3. リファクタリングで品質を向上

### 2. 適切な粒度でのコミット
**タスク単位・機能単位で適宜コミットを行うこと**
- 1つの機能追加または修正ごとにコミット
- コミットメッセージは変更内容を明確に記述
- 大きな変更は複数の小さなコミットに分割

### 3. コード品質の検証
**コミット前に必ず以下のすべてが成功することを確認すること**
- `npm run build` - TypeScriptとViteビルドの成功を確認
- `npm run lint` - ESLintによるコード品質チェック
- `npm run format` - Prettierによるコードフォーマット
- `npm test` - すべてのユニットテストの成功
- 必要に応じて `npm run dist:mac` または `npm run dist:win` でプロダクションビルドを確認

### 4. 実動作を検証するテスト
**mockのみのテストは禁止、実機能を検証すること**
- 単体テスト：実際の動作を確認（モックは最小限）
- 統合テスト：実際のEPUBファイルで完全な処理フローを検証
- E2Eテスト：ファイル出力まで確認

### 5. ブランチ戦略とPull Request
**すべての変更はブランチを作成してPull Request経由でマージすること**
- 機能開発: `feature/機能名` 形式のブランチ名
- バグ修正: `fix/修正内容` 形式のブランチ名
- リファクタリング: `refactor/対象` 形式のブランチ名
- ドキュメント: `docs/内容` 形式のブランチ名
- Pull Request作成時は `gh pr create` を使用
- mainブランチへの直接コミットは原則禁止

## 📋 プロジェクト概要

### プロジェクトの目的
EPUBファイルから章別に画像を抽出し、整理されたフォルダ構造で保存するクロスプラットフォーム（Windows/macOS）デスクトップアプリケーションを開発する。

### 主要機能
- **ドラッグ&ドロップGUIインターフェース** - 直感的なファイル入力
- **並列実行での複数ファイル処理** - 高速処理の実現
- **目次を使用した章ベースの画像整理** - 構造化された出力
- **リアルタイム進捗トラッキング** - ユーザーフィードバック
- **包括的エラーハンドリングと報告** - 安定性の確保
- **クロスプラットフォーム実行ファイル配布** - 幅広い利用者への対応

## 🛠 技術仕様

### 技術スタック
- **フレームワーク**: Electron 37
- **プログラミング言語**: TypeScript 5
- **UIライブラリ**: React 19
- **ビルドツール**: Vite 7
- **EPUBパーサー**: xml2jsを使用したカスタム実装
- **国際化**: i18next（初期状態では日本語のみ対応）

### サポート形式
- **EPUB 3.0形式**を完全サポート
- **ZIP圧縮されたEPUBファイル**の自動展開

## 📥 入力処理仕様

### 対応ファイル形式
- EPUBファイル（.epub）
- EPUBを含むZIPファイル（.zip）

### 処理方式
- 複数ファイルを並列実行で同時処理
- ユーザーフィードバック付きファイル形式検証

## 📤 出力仕様

### ディレクトリ構造
```
EPUB_Images/
└── [書籍タイトル]/
    ├── 001_表紙/
    │   ├── 001.jpg
    │   └── 002.jpg
    ├── 002_第1章/
    │   ├── 001.png
    │   ├── 002.png
    │   └── 003.jpg
    └── 003_第2章/
        └── 001.jpg
```

### 命名規則
- **章フォルダ**: `{順序:3桁}_{chapter_title}/`
  - 例: `001_表紙/`, `002_第1章/`
- **画像ファイル**: 連続番号 `001.jpg`, `002.png` など
  - 元の画像ファイル名を引き継ぐのではなく、全てのページに対応して連番とすること
  - オプション: 元のファイル名を含める、見開き情報を含める

### 画像処理
- **形式保持**: 元の画像形式を維持（JPEG、PNG、WebPなど）
- **複数ページ章対応**: 1つの章に複数ページがある場合、すべての画像を同一章フォルダに集約

## 📚 EPUB解析仕様

### 目次処理
- **目次あり**: ナビゲーションドキュメントから章情報を抽出
- **目次なし**: 全画像を `001_未分類/` フォルダに配置
- **ユーザー通知**: 目次情報がない場合のユーザー通知

### 正しい解析フロー
1. `META-INF/container.xml` からOPFファイルのパスを取得
2. OPFファイルに含まれる`itemref`から各ページを認識する
3. ページの示すファイルを解析し、参照している画像パスを取得する


## ⚠️ エラーハンドリング

### エラーハンドリング戦略
- **EPUBレベルエラー**: 他のEPUBの処理を継続、最後にエラー概要を表示
- **内部ファイルエラー**: そのEPUBの処理を停止、詳細なエラー情報をログに記録
- **ユーザー通知**: エラー詳細と処理中断を明確に表示

## 🖥 GUI仕様

### ウィンドウ構成
- **メインウィンドウ**: ドラッグ&ドロップエリア + 進捗表示
- **設定ウィンドウ**: 設定用の別モーダルウィンドウ

### 機能要件
- **進捗トラッキング**: ファイル別のリアルタイム進捗表示
- **出力ディレクトリ**: 設定経由で設定可能（デフォルト: デスクトップ）
- **言語設定**: UIのテキスト、メッセージは多言語対応（i18n）


## 🔄 更新履歴

- 2025-07-09: 初版作成（プロジェクト仕様書として再構成）