# CLAUDE.md

## 重要な作業規則

### ビルド検証の必須化
- **すべての機能改修・バグ修正後は、必ずビルドが成功することを確認してから作業完了とすること**
- ビルド検証手順：
  1. `npm run build` でTypeScriptコンパイルとViteビルドの成功を確認
  2. 必要に応じて `npm run dist:mac` または `npm run dist:win` でプロダクションビルドの成功を確認
  3. ビルドエラーが発生した場合は、必ず修正してから作業を完了とする

### タスク管理とコミットルール
- **タスクリストを作成した場合、1つのタスク完了ごとに必ずgit commitを行うこと**
- コミット時の手順：
  1. タスクが完了したら、関連するすべての変更をステージング
  2. タスクの内容を明確に示すコミットメッセージを作成
  3. ビルドが成功することを確認してからコミット
  4. 次のタスクに着手する前に、現在の状態が安定していることを確認

## プロジェクトについて

- EPUBファイルから章別に画像を抽出するクロスプラットフォーム（Windows/macOS）デスクトップアプリケーション
- コア機能
  - ドラッグ&ドロップGUIインターフェース
  - 並列実行での複数ファイル処理
  - 目次を使用した章ベースの画像整理
  - リアルタイム進捗トラッキング
  - 包括的エラーハンドリングと報告
  - クロスプラットフォーム実行ファイル配布
- 技術スタック
  - TypeScript
- 機能要件
  - 入力処理
    - EPUBファイル、EPUBを含むZIPファイル
    - 複数ファイルを並列実行で同時処理
    - ユーザーフィードバック付きファイル形式検証
- 出力整理
  - 章ベース構造: 目次に基づいた画像整理
  - ディレクトリ命名: `{順序:3桁}_{chapter_title}/`
    - 例: `001_表紙/`, `002_第1章/`
  - 画像命名: 連続番号 `001.jpg`, `002.png` など
    - 元の画像ファイル名を引き継ぐのではなく、全てのページに対応して連番とすること
  - 形式保持: 元の画像形式を維持（JPEG、PNG、WebPなど）
  - 複数ページ章対応: 1つの章に複数ページがある場合、すべての画像を同一章フォルダに集約
- 目次処理
  - 目次あり: ナビゲーションドキュメントから章情報を抽出
  - 目次なし: 全画像を `001_未分類/` フォルダに配置
  - ユーザー通知: 目次情報がない場合のユーザー通知
- エラーハンドリング戦略
  - EPUBレベルエラー: 他のEPUBの処理を継続、最後にエラー概要を表示
  - 内部ファイルエラー: そのEPUBの処理を停止、詳細なエラー情報をログに記録
  - ユーザー通知: エラー詳細と処理中断を明確に表示
- GUI要件
  - メインウィンドウ: ドラッグ&ドロップエリア + 進捗表示
  - 設定ウィンドウ: 設定用の別モーダルウィンドウ
  - 進捗トラッキング: ファイル別のリアルタイム進捗表示
  - 出力ディレクトリ: 設定経由で設定可能（デフォルト: デスクトップ）
- @gxl/epub-parser を採用した場合、 `navigation` プロパティを提供しない可能性があるので、その場合は回避策を適用すること
- ページに対応する画像ファイルはepubを正しく解析してページに含まれる画像を取得すること
  - 正しい解析とは以下のような流れを意図します
    1. META-INF/container.xml からOPFファイルのパスを取得
    2. OPFファイルに含まれるitemrefから各ページを認識する
    3. ページの示すファイルを解析し、参照している画像パスを取得する
- mockのみのテストは禁止
  - 実機能を検証する意味のあるテストを実装すること
- 統合テスト
  - 実際のEPUBファイルでテスト
  - 完全な処理フローを検証
  - ファイル出力まで確認
- EPUB 3.0形式サポート
- UIのテキスト、メッセージは多言語対応とし、初期状態では日本語のみ対応でよい
