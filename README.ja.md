# EPUB画像抽出ツール

![Platform](https://img.shields.io/badge/platform-Windows%20%7C%20macOS-green.svg)
![License](https://img.shields.io/badge/license-MIT-blue.svg)

EPUBファイルから章別に画像を抽出するクロスプラットフォームデスクトップアプリケーション

## 機能

- **ドラッグ&ドロップインターフェース**: EPUBファイルをドラッグ&ドロップするだけで処理開始
- **ZIPファイル対応**: ZIP内のEPUBファイルを自動的に抽出して処理
- **章別整理**: EPUBの目次に基づいて画像をフォルダごとに整理
- **バッチ処理**: 複数のEPUBファイルを並列処理で同時に処理
- **リアルタイム進捗表示**: 各ファイルの抽出進捗をモニタリング
- **設定管理**: 出力先ディレクトリや処理オプションをカスタマイズ可能
- **クロスプラットフォーム**: WindowsとmacOSに対応

## インストール

### ビルド済みバイナリのダウンロード

最新版は[Releases](../../releases)ページからダウンロードできます。

#### macOSでの初回起動について

macOSで初めてアプリを起動する際、以下の警告が表示される場合があります：

> 「EPUB Image Extractor」は、開発元を検証できないため開けません。

アプリを開くには：
1. Finderでアプリを右クリック（またはControlキーを押しながらクリック）
2. 「開く」を選択
3. 表示されるダイアログで「開く」をクリック

この操作は初回起動時のみ必要です。アプリは基本的なセキュリティのためad-hoc署名されています。

### 前提条件（開発用）

- Node.js 24.0.0以上
- npm

### 開発環境のセットアップ

```bash
# リポジトリをクローン
git clone <repository-url>
cd epub-image-extractor

# 依存関係をインストール
npm install

# 開発モードで実行
npm run electron:dev
```

### プロダクションビルド

```bash
# 現在のプラットフォーム用にビルド
npm run dist

# Windows用にビルド（インストーラーとポータブル版）
npm run dist:win

# macOS用にビルド
npm run dist:mac

# 特定のアーキテクチャ用
npm run dist:mac-x64    # Intel Mac用
npm run dist:mac-arm64  # Apple Silicon Mac用
```

### 配布形式

- **Windows**: NSISインストーラー（.exe）およびポータブル版
- **macOS**: IntelとApple Silicon両対応のDMGインストーラー

## 使い方

1. アプリケーションを起動
2. EPUBファイルまたはEPUBを含むZIPファイルをドロップゾーンにドラッグ&ドロップ、または「ファイルを選択」をクリック
3. アプリケーションが自動的に画像を抽出し、章ごとに整理
4. 画像は `デスクトップ/EPUB_Images/[書籍名]/[章名]/` に保存されます（デフォルト設定、変更可能）
5. ヘッダーの設定アイコン（⚙️）をクリックして以下をカスタマイズ：
   - 出力先ディレクトリ
   - 並列処理ファイル数（1-10）
   - ファイル名オプション（元のファイル名を含める、見開き情報を含める）

### 出力構造

```
EPUB_Images/
└── 書籍タイトル/
    ├── 001_表紙/
    │   ├── 001.jpg          # デフォルト：連番
    │   └── 002.jpg          # 元の名前付き：001_cover.jpg
    ├── 002_第1章/
    │   ├── 001.png          # 見開き情報付き：001_left.png
    │   ├── 002.png          # 見開き情報付き：002_right.png
    │   └── 003.jpg
    └── 003_第2章/
        └── 001.jpg
```

### ファイル名オプション

- **連番**：`001.jpg`、`002.png`（デフォルト）
- **元のファイル名を含める**：`001_originalname.jpg`
- **見開き情報を含める**：`001_left.jpg`、`002_right.jpg`

## 技術仕様

### 技術スタック

- **フレームワーク**: Electron 37
- **言語**: TypeScript 5
- **UI**: React 19
- **ビルドツール**: Vite 7
- **EPUBパーサー**: fast-xml-parserを使用したカスタム実装
- **国際化**: i18next（日本語UI）
- **ログシステム**: pino（高性能JSONロガー）

### アーキテクチャ

アプリケーションの構成:
- **メインプロセス**: ファイル操作とEPUB処理を担当
- **レンダラープロセス**: ユーザーインターフェースを管理
- **IPC通信**: プロセス間のセキュアな通信

## 開発

### プロジェクト構造

```
src/
├── main/           # Electronメインプロセス
│   ├── epub/       # EPUB処理ロジック
│   └── ipc/        # IPCハンドラー
├── renderer/       # Reactアプリケーション
│   └── components/ # UIコンポーネント
├── preload/        # プリロードスクリプト
└── shared/         # 共有型定義とユーティリティ
```

### テストの実行

```bash
# 単体テストを実行
npm test

# 統合テストを実行
npm run test:integration

# すべてのテストを実行
npm run test:all

# カバレッジ付きでテストを実行
npm run test:coverage
```

### コード品質

```bash
# ESLintを実行
npm run lint

# ESLintの問題を修正
npm run lint:fix

# コードフォーマット
npm run format

# 型チェック
npm run typecheck
```

## セキュリティ機能

- **パストラバーサル攻撃対策**: 悪意のあるEPUBファイルが抽出ディレクトリ外のファイルにアクセスすることを防止
- **リソース制限**: リソース枯渇攻撃から保護
  - 最大画像サイズ: 1画像あたり50MB
  - 最大画像数: 1EPUBあたり10,000枚
  - メモリ使用量の監視
- **ファイル名のサニタイズ**: 異なるOSで安全なファイル名を保証

## アプリケーションアイコン

本アプリケーションは、開いた本から画像が浮かび上がるデザインのカスタムアイコンを使用しています。アイコンの設定方法：

1. 1024x1024 PNGアイコンを `build/icon.png` に配置
2. ビルドプロセスが自動的にプラットフォーム別のフォーマットを生成：
   - Windows: `icon.ico`
   - macOS: `icon.icns`

## トラブルシューティング

### ログの確認

アプリケーションはpinoを使用してログを記録しています。問題が発生した場合は、以下の場所でログファイルを確認できます：

- **Windows**: `%APPDATA%\epub-image-extractor\app.log`
- **macOS**: `~/Library/Application Support/epub-image-extractor/app.log`

開発時にデバッグログを有効にするには：
```bash
LOG_LEVEL=debug npm run electron:dev
```

### よくある問題

1. **「Cannot find module」エラー**: `npm install`を実行してすべての依存関係がインストールされているか確認
2. **macOSでのビルド失敗**: Xcode Command Line Toolsのインストールが必要な場合があります
3. **大きなEPUBファイル**: 多くの画像を含むファイルは処理に時間がかかります。リソース制限に達した場合は警告が表示されます
4. **目次情報がない場合**: 目次が正しく設定されていないEPUBでは、すべての画像が「001_未分類」フォルダに抽出されます

## 既知の問題

- 目次情報のないEPUBファイルの場合、すべての画像が「001_未分類」フォルダに保存されます

## ライセンス

MIT

## 貢献

貢献を歓迎します！お気軽にPull Requestを送信してください。

### 開発ガイドライン

1. 既存のコードスタイルに従う
2. 新機能にはテストを追加
3. 必要に応じてドキュメントを更新
4. PR提出前にすべてのテストがパスすることを確認

## サポート

問題が発生した場合は、GitHubのIssuesページで報告してください。